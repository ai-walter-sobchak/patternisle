<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Game UI</title>

  <!-- HUD Styles -->
  <link rel="stylesheet" href="{{CDN_ASSETS_URL}}/ui/hud.css" />
</head>

<body>

  <!-- ============================= -->
  <!-- HUD ROOT -->
  <!-- ============================= -->

  <div id="hud-root" class="hud">

    <div class="hud-top">

      <!-- Left: Shards + Progress + Health -->
      <div class="hud-left">
        <div class="hud-shards" id="hud-shards">
          <div class="hud-shards-main">
            <span class="hud-shards-icon" aria-hidden="true">â—†</span>
            <span class="hud-shards-value" id="hud-shards-value">0</span>
          </div>

          <!-- NEW: progress to win -->
          <div class="hud-progress">
            <div class="hud-progress-top">
              <span id="hud-progress-label" class="hud-progress-label">0 / 0</span>
              <span id="hud-progress-remaining" class="hud-progress-remaining">+0 to win</span>
            </div>
            <div class="hud-progress-bar">
              <div id="hud-progress-fill" class="hud-progress-fill" style="width:0%"></div>
            </div>
          </div>
        </div>

        <div class="hud-health hidden" id="hud-health" aria-label="Health">
          <span class="hud-health-shield hidden" id="hud-health-shield" aria-hidden="true" title="Spawn protection">ðŸ›¡</span>
          <div class="hud-health-bar">
            <div id="hud-health-fill" class="hud-health-fill" style="width:100%"></div>
          </div>
          <span class="hud-health-value" id="hud-health-value">100</span>
        </div>

        <div class="hud-buffs" id="hud-buffs" aria-label="Active power-up buffs"></div>
      </div>

      <!-- Center: Round -->
      <div class="hud-round-wrap">
        <div class="hud-round">
          <span class="hud-round-num" id="hud-round-num">Round 1</span>
          <span class="hud-round-status running" id="hud-round-status">RUNNING</span>
        </div>
      </div>

      <!-- Right: Match timer + Settings -->
      <div class="hud-top-right">
        <div class="hud-timer" aria-label="Match timer">
          <div id="hud-status-badge" class="hud-status-badge">LOBBY</div>
          <div id="hud-timer-text" class="hud-timer-text">--:--</div>
        </div>

        <button
          type="button"
          class="hud-settings-btn"
          aria-label="HUD settings"
          title="HUD settings">
          âš™
        </button>
      </div>

    </div>

    <!-- Scoreboard (top-right, below top row) -->
    <div class="hud-scoreboard">
      <div class="hud-scoreboard__title">Leaderboard</div>
      <ol id="hud-scoreboard-list" class="hud-scoreboard__list"></ol>
    </div>

    <!-- Feed + Toasts -->
    <div class="hud-feed"></div>
    <div class="hud-toast-stack"></div>

    <!-- Settings Panel -->
    <div class="hud-settings-panel" id="hud-settings-panel" aria-hidden="true">

      <h3>HUD Settings</h3>

      <div class="hud-settings-row">
        <label>Scale</label>
        <div class="hud-settings-scale" role="group" aria-label="HUD scale">
          <button type="button" data-scale="0.8">0.8</button>
          <button type="button" data-scale="1">1.0</button>
          <button type="button" data-scale="1.2">1.2</button>
        </div>
      </div>

      <div class="hud-settings-row">
        <label for="hud-reduce-motion">Reduce motion</label>
        <button
          type="button"
          class="hud-settings-toggle"
          id="hud-reduce-motion"
          role="switch"
          aria-checked="false">
        </button>
      </div>

      <div class="hud-settings-row">
        <label for="hud-mute-sounds">Mute UI sounds</label>
        <button
          type="button"
          class="hud-settings-toggle"
          id="hud-mute-sounds"
          role="switch"
          aria-checked="false">
        </button>
      </div>

    </div>

    <!-- Lobby: mode selection + Start (shown when status === LOBBY) -->
    <div id="hud-lobby-panel" class="hud-lobby-panel hidden" aria-hidden="true">
      <div class="hud-lobby-card hud-card">
        <h2 class="hud-lobby-title">Lobby</h2>
        <p class="hud-lobby-subtitle">Select game mode</p>
        <div class="hud-lobby-modes" role="group" aria-label="Game mode">
          <button type="button" class="hud-lobby-mode" data-mode="MULTI">Shard race (with bots)</button>
          <button type="button" class="hud-lobby-mode" data-mode="SOLO">Solo shard race</button>
          <button type="button" class="hud-lobby-mode" data-mode="tower">Tower (deposit at center)</button>
          <button type="button" class="hud-lobby-mode" data-mode="survival">Survival</button>
          <button type="button" class="hud-lobby-mode" data-mode="timetrial">Time trial</button>
        </div>
        <button type="button" class="hud-lobby-start" id="hud-lobby-start">Start game</button>
      </div>
    </div>

    <div id="hud-end-overlay" class="hud-end-overlay hidden" aria-hidden="true">
      <div class="hud-end-card" role="dialog" aria-label="Match results">
        <div class="hud-end-title">Match Over</div>
        <div id="hud-end-winner" class="hud-end-winner"></div>
        <ol id="hud-end-leaderboard" class="hud-end-leaderboard"></ol>
        <div id="hud-end-countdown" class="hud-end-countdown"></div>
      </div>
    </div>

  </div>

  <!-- ============================= -->
  <!-- Ping Debug -->
  <!-- ============================= -->

  <div id="ping-debug" class="ping-debug"></div>

  <!-- ============================= -->
  <!-- Mobile Controls -->
  <!-- ============================= -->

  <div class="mobile-controls">
    <a id="mobile-interact-button" class="mobile-button">
      <img src="{{CDN_ASSETS_URL}}/icons/target.png" />
    </a>

    <a id="mobile-jump-button" class="mobile-button">
      <img src="{{CDN_ASSETS_URL}}/icons/jump.png" />
    </a>
  </div>

  <!-- ============================= -->
  <!-- Scripts -->
  <!-- ============================= -->

  <script src="{{CDN_ASSETS_URL}}/ui/hud.js"></script>

  <script>
    window.addEventListener('DOMContentLoaded', () => {

      const mobileInteractButton = document.getElementById('mobile-interact-button');
      const mobileJumpButton = document.getElementById('mobile-jump-button');

      function sendInteractStart() {
        if (window.hytopia && typeof window.hytopia.sendData === 'function') {
          window.hytopia.sendData({ type: 'interact_start' });
        }
      }
      function sendInteractEnd() {
        if (window.hytopia && typeof window.hytopia.sendData === 'function') {
          window.hytopia.sendData({ type: 'interact_end' });
        }
      }

      if (mobileInteractButton) {
        mobileInteractButton.addEventListener('touchstart', e => {
          e.preventDefault();
          mobileInteractButton.classList.add('active');
          if (window.hytopia) hytopia.pressInput('ml', true);
          if (typeof window.triggerAttack === 'function') window.triggerAttack();
          sendInteractStart();
        });

        mobileInteractButton.addEventListener('touchend', e => {
          e.preventDefault();
          mobileInteractButton.classList.remove('active');
          if (window.hytopia) hytopia.pressInput('ml', false);
          sendInteractEnd();
        });
      }

      document.addEventListener('keydown', function (e) {
        if (e.key === 'e' || e.key === 'E') {
          if (e.repeat) return;
          sendInteractStart();
        }
      });
      document.addEventListener('keyup', function (e) {
        if (e.key === 'e' || e.key === 'E') {
          sendInteractEnd();
        }
      });

      if (mobileJumpButton) {
        mobileJumpButton.addEventListener('touchstart', e => {
          e.preventDefault();
          mobileJumpButton.classList.add('active');
          if (window.hytopia) hytopia.pressInput(' ', true);
        });

        mobileJumpButton.addEventListener('touchend', e => {
          e.preventDefault();
          mobileJumpButton.classList.remove('active');
          if (window.hytopia) hytopia.pressInput(' ', false);
        });
      }

    });
  </script>

  <!-- ============================= -->
  <!-- Styles -->
  <!-- ============================= -->

  <style>
    .ping-debug {
      position: fixed;
      top: 4px;
      left: 4px;
      font-size: 10px;
      font-family: monospace;
      color: rgba(0, 255, 0, 0.9);
      pointer-events: none;
      z-index: 9999;
    }

    .mobile-controls {
      display: none;
    }

    body.mobile .mobile-controls {
      display: flex;
      gap: 14px;
      position: fixed;
      bottom: 40px;
      right: 40px;
    }

    .mobile-button {
      background-color: rgba(0, 0, 0, 0.5);
      border-radius: 50%;
      align-items: center;
      justify-content: center;
      display: flex;
      width: 50px;
      height: 50px;
      transition: all 0.15s ease;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
      pointer-events: auto !important;
    }

    .mobile-button img {
      width: 22px;
      height: 22px;
    }

    .mobile-button.active {
      transform: scale(0.92);
      background-color: rgba(0, 0, 0, 0.75);
    }
  </style>

</body>
</html>
